name: Publish website
on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  Publish:
    name: Publish
    runs-on: ubuntu-latest

    permissions:
      contents: read
      # To report GitHub Actions status checks
      statuses: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          path: python_code

      # - name: Setup python
      #   uses: actions/setup-python@v4
      #   with:
      #     python-version: "3.11.2"
      #     cache: "pip"

      # - name: Install dependencies
      #   run: |
      #     python -m pip install --upgrade pip
      #     pip install -r python_code/requirements.txt

      # - name: Run scripts
      #   run: |
      #     cd python_code
      #     python3 process_universal_data.py

      - name: Publish website
        if: github.ref == 'refs/heads/main'
        run: |
          git clone https://github.com/anderpups/anderpups.github.io.git
          cd anderpups.github.io      
          cp -fv ../python_code/data/* ./
          git config user.name "github-actions"
          git config user.email "github-actions@fake.com"
          git remote set-url origin https://github-actions:${{ secrets.ANDERPUPS_GITHUB_IO_PAT }}@github.com/anderpups/anderpups.github.io.git
          git add .
          git commit -m "Update website" --allow-empty
          git push --verbose
